@model MyTryHard.Models.Tracker.PieChart
@using MyTryHard.Models.Tracker
@using MyTryHard.Helpers

<svg height="510" width="700">
    <style type="text/css">
        .slice:hover {
            filter: brightness(120%) drop-shadow(0.4em 0.4em 2px rgba(0,0,0,0.5));
        }

        g text {
            font-family: "Open Sans", Tahoma, serif;
            font-size: 0.8rem;
        }
    </style>
    @{
        // Calculate how much angle is a slice.
        double totalValues = Model.Slices.Sum(x => x.Value);
        double anglePerValue = 360.0d / totalValues;
        int lastTextHeight = 20;
        int textAlign = 550;

        double radius = 250;
        double radOffset = 251;
        double startAngle = 0;
        double endAngle = 0;
        foreach (PieChart.PieChartSlice slice in Model.Slices)
        {
            // Calculate angle of the slice.
            startAngle = endAngle;
            endAngle = startAngle + (slice.Value * anglePerValue);

            var startAngleRad = Math.PI * startAngle / 180;
            var endAngleRad = Math.PI * endAngle / 180;

            // First coord of arc.
            var x1 = radOffset + radius * Math.Cos(startAngleRad);
            var y1 = radOffset + radius * Math.Sin(startAngleRad);

            // Second coord of arc
            var x2 = radOffset + radius * Math.Cos(endAngleRad);
            var y2 = radOffset + radius * Math.Sin(endAngleRad);

            int bigArc = (endAngle - startAngle) > 180 ? 1 : 0;
            var d = "M250,250  L" + x1.NumString() + "," + y1.NumString() + "  A250,250 0 " + bigArc + ",1 " + x2.NumString() + "," + y2.NumString() + " Z L" + x2.NumString() + "," + y2.NumString() + "";
            <g>
                <title>@slice.Label (@slice.Value)</title>
                <text x="@(textAlign - 10)" y="@(lastTextHeight - 1)" fill="@slice.Color">■</text> 
                <text x="@textAlign" y="@lastTextHeight">@((slice.Value / totalValues).ToString("0.00 %")) - @slice.Label (@slice.Value) </text>
                <path class="slice" d="@d.ToString()" stroke-linejoin="miter" stroke="black" stroke-width="1" fill="@slice.Color" />
            </g>

            lastTextHeight += 30;
        }
    }
</svg>